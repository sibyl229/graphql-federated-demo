input {
  pipe {
    command => "aws s3 cp s3://mod-datadumps/3.0.0/VARIATION/WB/1.0.1.0_VARIATION_WB_0.json - | jq -c '.data[]'"
  }
}

filter {
  json {
    source => "message"
  }

  split {
    field => "data"
  }

  kv {
    source => "[data][sequenceOfReferenceAccessionNumber]"
    value_split => ":"
  }

  mutate {
    remove_field => [ "message", "metaData" ]
  }

  if [data][genomicReferenceSequence] == "N/A" {
    mutate {
      add_field => {
        "variantType" => "insersion"
        "variantId" => "%{RefSeq}:g.%{[data][start]}_%{[data][end]}ins%{[data][genomicVariantSequence]}"
      }
    }
  } else if [data][genomicVariantSequence] == "N/A" {
    mutate {
      add_field => {
        "variantType" => "deletion"
        "variantId" => "%{RefSeq}:g.%{[data][start]}_%{[data][end]}del"
      }
    }
  } else {
    mutate {
      add_field => {
        "variantType" => "substitution"
        "variantId" => "%{RefSeq}:g.%{[data][start]}%{[data][genomicReferenceSequence]}>%{[data][genomicVariantSequence]}"
      }
    }
  }
}

output {
  stdout {}
}
